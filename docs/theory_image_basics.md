# 画像処理基礎理論

## 1. 画像の基本的な概念

### 1.1 ピクセルと解像度

- **ピクセル (Pixel)**: 画像を構成する最小単位
  - Picture Element の略
  - 画素（がそく）とも呼ばれる

- **解像度 (Resolution)**:
  - 画像のサイズ（ピクセル数）
  - 例: 1920x1080 = 2,073,600 ピクセル
  - 高解像度ほど詳細が表現できる

### 1.2 色の表現方法

#### RGBカラーモデル
- **R (Red)**: 赤成分
- **G (Green)**: 緑成分
- **B (Blue)**: 青成分
- 各成分は通常 0-255 の値で表現
- 合計 256^3 = 16,777,216 色の表現が可能

#### グレースケール
- 明度情報のみを持つ
- 0（黒）から 255（白）までの値
- 計算効率が良い

## 2. 画像データの形式

### 2.1 ビット深度
- 1ピクセルを表現するのに使うビット数
- 例: 8-bit → 256階調
- 16-bit → 65,536階調
- 足りないと色ジャンプが発生する

### 2.2 カラーチャンネル
- **RGB**: 光の三原色（加法混色）
- **CMYK**: 印刷の四色（減法混色）
- **HSV**: 色相・彩度・明度
  - H: 0-360度
  - S: 0-100%
  - V: 0-100%

## 3. 画像処理の基本操作

### 3.1 画像の幾何学的変換

#### トリミング (Cropping)
- 画像の一部を切り出す
- 情報の損失があるが、計算は簡単

```python
# トリミングの例
cropped = image[y:y+height, x:x+width]
```

#### リサイズ (Resizing)
- 画像のサイズを変更
- 補間アルゴリズムによって品質が変わる
  - 最近傍法: 最も速いが荒い
  - バイリニア: バランスが良い
  - バイキュービック: 高品質だが遅い

```python
# リサイズの例
resized = cv2.resize(image, (new_width, new_height))
```

#### 回転・アフィン変換
- 行列を使って幾何学的変換を行う
- 回転、スケーリング、シアリング、アフィン変換が可能

### 3.2 色空間変換

#### RGB ↔ グレースケール
- 重み付け平均による変換
- 人間の視覚特性を考慮した重み付けが一般的

```python
# OpenCVでのグレースケール変換
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
```

#### RGB ↔ HSV
- 色操作に便利
- 色相の調整だけで色を変えられる

```python
# RGBからHSVへ
hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)
```

## 4. 画像の保存形式

### 4.1 圧縮形式の比較

| 形式 | 特徴 | 用途 |
|------|------|------|
| JPEG | 損失圧縮、ファイルサイズ小 | Web写真、保存用 |
| PNG | 非損失圧縮、透明度対応 | ロゴ、アイコン |
| BMP | 非圧縮 | 高品質保存 |
| TIFF | 圧縮オプション多 | プロ用 |

### 4.2 ファイル形式の選択基準

- **保存スペース**: JPEG
- **品質重視**: PNG, TIFF
- **Web用**: JPEG, PNG
- **編集用**: PNG, TIFF

## 5. パフォーマンス最適化

### 5.1 メモリ効率

- 不要な画像データを即時解放
- ループ内で同じ画像を複数回読み込まない

### 5.2 並列処理
- OpenCVは内部で最適化されているが、大きな画像は分割処理が有効

### 5.3 キャッシュ戦略
- 頻繁に使う画像はメモリに保持
- 一度読み込んだファイルを再利用

## 6. エラーハンドリング

### 6.1 画像ファイルの検証
```python
import cv2

def safe_read_image(path):
    image = cv2.imread(str(path))
    if image is None:
        raise ValueError(f"画像ファイル {path} の読み込みに失敗しました")
    return image
```

### 6.2 メモリ不足対策
- 画像のサイズを事前に確認
- 必要に応じてリサイズしてから処理

## 7. 実践的なアドバイス

### 7.1 デバッグ時のヒント
- 画像の形状を常に確認する
- ピクセル値の範囲をチェックする
- 期待通りのデータ型か確認する

### 7.2 高品質な画像処理のために
- 適切な解像度を選択
- 過度な加工は避ける
- 出力形式を目的に合わせて選択

### 7.3 パフォーマンスチューニング
- 処理順序を最適化
- 不要な中間結果は保持しない
- ベンチマークを定期的に実施

## 参考資料

- [OpenCV公式ドキュメント](https://docs.opencv.org/)
- [Pillow公式ドキュメント](https://pillow.readthedocs.io/)
- [NumPy配列操作ガイド](https://numpy.org/doc/stable/)